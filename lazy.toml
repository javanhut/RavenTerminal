# Generated by imlazy migrate from Makefile

[settings]
default = "all"

[variables]
app_name = "raven-terminal"
version = "$(git describe --tags --always --dirty 2>/dev/null || echo \"dev\")"
scripts_dir = "scripts"
build_dir = "."
blue = "\\033[0;34m"
green = "\\033[0;32m"
yellow = "\\033[1;33m"
red = "\\033[0;31m"
nc = "\\033[0m"
os = "$(uname -s)"
distro = "unknown"
pkg_manager = "unknown"

[commands]

[commands.all]
desc = "Default target"
dep = ["build"]

[commands.build]
desc = "Build the application"
run = [
  "echo -e \"{{blue}}[INFO]{{nc}} Building {{app_name}}...\"",
  "go build -o {{app_name}} ./src",
  "chmod +x {{app_name}}",
  "echo -e \"{{green}}[OK]{{nc}} Build successful: ./{{app_name}}\"",
]

[commands.install]
desc = "Install system-wide (clean install - uninstalls first)"
run = [
  "echo -e \"{{blue}}[INFO]{{nc}} Performing clean global install...\"",
  "{{scripts_dir}}/uninstall.sh --all --force 2>/dev/null || true",
  "{{scripts_dir}}/install.sh --global",
]
dep = ["build"]

[commands.install-local]
desc = "Install for current user (clean install - uninstalls first)"
run = [
  "echo -e \"{{blue}}[INFO]{{nc}} Performing clean user install...\"",
  "{{scripts_dir}}/uninstall.sh --all --force 2>/dev/null || true",
  "{{scripts_dir}}/install.sh --user",
]
dep = ["build"]

[commands.uninstall]
desc = "Uninstall all installations (clean uninstall)"
run = [
  "echo -e \"{{blue}}[INFO]{{nc}} Uninstalling all raven-terminal installations...\"",
  "{{scripts_dir}}/uninstall.sh --all --force",
]

[commands.uninstall-local]
desc = "Uninstall user installation"
run = [
  "echo -e \"{{blue}}[INFO]{{nc}} Uninstalling user installation...\"",
  "{{scripts_dir}}/uninstall.sh --user --force",
]

[commands.uninstall-all]
desc = "Uninstall everything including config"
run = [
  "echo -e \"{{blue}}[INFO]{{nc}} Uninstalling all installations and config...\"",
  "{{scripts_dir}}/uninstall.sh --all --config --force",
]

[commands.clean]
desc = "Clean build artifacts"
run = [
  "echo -e \"{{blue}}[INFO]{{nc}} Cleaning build artifacts...\"",
  "rm -f {{app_name}}",
  "go clean",
  "echo -e \"{{green}}[OK]{{nc}} Clean complete\"",
]

[commands.deps-check]
desc = "Check if dependencies are installed"
run = [
  "echo -e \"{{blue}}[INFO]{{nc}} Checking dependencies...\"",
  "echo -e \"{{blue}}[INFO]{{nc}} Detected OS: {{os}} ({{distro}})\"",
  "echo -e \"{{blue}}[INFO]{{nc}} Package manager: {{pkg_manager}}\"",
  "echo \"\"",
  "missing=\"\"; if ! command -v go >/dev/null 2>&1; then echo -e \"{{red}}[MISSING]{{nc}} Go compiler\"; missing=\"$$missing go\"; else echo -e \"{{green}}[OK]{{nc}} Go compiler: $$(go version | awk '{print $$3}')\"; fi; if ! command -v pkg-config >/dev/null 2>&1; then echo -e \"{{red}}[MISSING]{{nc}} pkg-config\"; missing=\"$$missing pkg-config\"; else echo -e \"{{green}}[OK]{{nc}} pkg-config\"; fi; if ! pkg-config --exists gl 2>/dev/null; then echo -e \"{{red}}[MISSING]{{nc}} OpenGL development libraries\"; missing=\"$$missing opengl\"; else echo -e \"{{green}}[OK]{{nc}} OpenGL libraries\"; fi; if ! pkg-config --exists x11 2>/dev/null && ! pkg-config --exists wayland-client 2>/dev/null; then echo -e \"{{red}}[MISSING]{{nc}} X11 or Wayland development libraries\"; missing=\"$$missing display\"; else echo -e \"{{green}}[OK]{{nc}} Display libraries (X11/Wayland)\"; fi; echo \"\"; if [ -n \"$$missing\" ]; then echo -e \"{{yellow}}[WARNING]{{nc}} Some dependencies are missing. Run 'make deps' to install them.\"; exit 1; else echo -e \"{{green}}[OK]{{nc}} All dependencies are installed!\"; fi",
]

[commands.deps]
desc = "Install dependencies based on detected OS"
run = [
  "echo -e \"{{blue}}[INFO]{{nc}} Installing dependencies...\"",
  "echo -e \"{{blue}}[INFO]{{nc}} Detected OS: {{os}} ({{distro}})\"",
  "echo -e \"{{blue}}[INFO]{{nc}} Package manager: {{pkg_manager}}\"",
  "echo \"\"",
]

[commands.test]
desc = "Run tests"
run = [
  "echo -e \"{{blue}}[INFO]{{nc}} Running tests...\"",
  "go test ./src/...",
]

[commands.make_help]
desc = "Show help"
run = [
  "echo \"\"",
  "echo -e \"{{blue}}Raven Terminal Makefile{{nc}}\"",
  "echo \"\"",
  "echo \"Usage: make [target]\"",
  "echo \"\"",
  "echo \"Targets:\"",
  "echo \" build Build the application (default)\"",
  "echo \" install Clean install system-wide (uninstalls first, requires sudo)\"",
  "echo \" install-local Clean install for current user (uninstalls first)\"",
  "echo \" uninstall Uninstall all installations (global + user)\"",
  "echo \" uninstall-local Uninstall user installation only\"",
  "echo \" uninstall-all Uninstall everything including config files\"",
  "echo \" clean Remove build artifacts\"",
  "echo \" deps Install build dependencies for your OS\"",
  "echo \" deps-check Check if all dependencies are installed\"",
  "echo \" test Run tests\"",
  "echo \" macos-icon Generate macOS app icon (macOS only)\"",
  "echo \" help Show this help message\"",
  "echo \"\"",
  "echo \"Detected System:\"",
  "echo \" OS: {{os}}\"",
  "echo \" Distribution: {{distro}}\"",
  "echo \" Package Manager: {{pkg_manager}}\"",
  "echo \"\"",
  "echo \"Examples:\"",
  "echo \" make deps # Install dependencies\"",
  "echo \" make # Build the application\"",
  "echo \" make install # Clean install system-wide (requires sudo)\"",
  "echo \" make uninstall # Completely remove all installations\"",
  "echo \"\"",
]

# Migration warnings:
# - conditional 'ifeq ($(OS),Linux)' cannot be fully converted
# - conditional 'ifneq ($(wildcard /etc/arch-release),)' cannot be fully converted
# - conditional 'ifeq ($(DISTRO),arch)' cannot be fully converted
# - conditional 'ifeq ($(OS),Darwin)' cannot be fully converted
